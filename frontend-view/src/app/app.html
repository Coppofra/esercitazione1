<div class="container">
  <h1>{{ title() }} - Visualizzazione Voti</h1>
  
  <!-- Messages -->
  <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <div class="search-section">
    <input 
      type="text" 
      [(ngModel)]="searchName" 
      (input)="filterGrades()"
      placeholder="Cerca per nome studente..."
      class="search-input"
    />
  </div>

  <!-- Edit Form -->
  <div *ngIf="showForm" class="form-section">
    <h2>Modifica Voto</h2>
    <form (ngSubmit)="submitForm()">
      <div class="form-group">
        <label for="studentName">Nome Studente:</label>
        <input 
          type="text" 
          id="studentName"
          [(ngModel)]="studentName" 
          name="studentName"
          required
          placeholder="Inserisci nome studente"
        />
      </div>

      <div class="form-group">
        <label for="subject">Materia:</label>
        <input 
          type="text" 
          id="subject"
          [(ngModel)]="subject" 
          name="subject"
          required
          placeholder="Inserisci materia"
        />
      </div>

      <div class="form-group">
        <label for="grade">Voto (1-10):</label>
        <input 
          type="number" 
          id="grade"
          [(ngModel)]="grade" 
          name="grade"
          min="1"
          max="10"
          step="0.01"
          required
          placeholder="Inserisci voto"
        />
      </div>

      <div class="form-group">
        <label for="date">Data:</label>
        <input 
          type="date" 
          id="date"
          [(ngModel)]="date" 
          name="date"
          required
        />
      </div>

      <div class="form-buttons">
        <button type="submit" class="btn btn-success">Aggiorna</button>
        <button type="button" (click)="closeForm()" class="btn btn-secondary">Annulla</button>
      </div>
    </form>
  </div>

  <div class="grades-table">
    <h2>Elenco Voti</h2>
    <div *ngIf="filteredGrades.length === 0" class="no-grades">
      <p>Nessun voto trovato per "{{ searchName }}"</p>
    </div>
    
    <div *ngIf="filteredGrades.length > 0" class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Nome Studente</th>
            <th>Materia</th>
            <th>Voto</th>
            <th>Data</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let grade of filteredGrades" [ngClass]="'grade-' + getGradeColor(grade.grade)">
            <td>{{ grade.student_name }}</td>
            <td>{{ grade.subject }}</td>
            <td class="grade-cell">{{ grade.grade }}</td>
            <td>{{ grade.date }}</td>
            <td class="actions">
              <button (click)="openForm(grade)" class="btn btn-small btn-edit">Modifica</button>
              <button (click)="deleteGrade(grade.id)" class="btn btn-small btn-delete">Elimina</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<router-outlet />
